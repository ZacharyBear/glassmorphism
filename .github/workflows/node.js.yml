# This workflow will do a clean installation of node dependencies, cache/restore them, build the source code and run tests across different versions of node
# For more information see: https://docs.github.com/en/actions/automating-builds-and-tests/building-and-testing-nodejs

name: CI GitHub Pages
on:
    push:
        branches: ['main']
    pull_request:
permissions:
    contents: read
    pages: write
    id-token: write
concurrency:
    group: 'pages'
    cancel-in-progress: true
jobs:
    # lint:
    #   name: Linting ğŸ”
    #   runs-on: ubuntu-latest
    #   strategy:
    #     matrix:
    #       node-version: [16.x, 18.x]
    #   steps:
    #     - name: Checkout ğŸ›ï¸
    #       uses: actions/checkout@v6
    #     - name: Linting
    #       uses: actions/setup-node@v6
    #       with: ${{ matrix.node-version }}
    #     - run: npm install
    #     - run: npm run lint

    build:
        name: Build
        # needs: lint
        runs-on: ubuntu-latest
        strategy:
            matrix:
                node-version: [18.18.0]
        steps:
            - name: ğŸ›ï¸ Checkout
              uses: actions/checkout@v6
              
            - name: ğŸš§ Build with Node.js ${{ matrix.node-version }}
              uses: actions/setup-node@v6
              with:
                  node-version: ${{ matrix.node-version }}
                  cache: 'npm'
            - run: npm install
            - run: npm run build

            - name: Copy index.html to 404.html
              run: cp dist/index.html dist/404.html
            
            - name: ğŸš€ Configuring
              if: github.ref == 'refs/heads/main'
              uses: actions/configure-pages@v5
              
            - name: â˜ï¸ Uploading
              if: github.ref == 'refs/heads/main'
              uses: actions/upload-pages-artifact@v4
              with:
                  path: './dist'
                  
    deploy:
        if: github.ref == 'refs/heads/main'
        name: Deploying
        needs: build
        runs-on: ubuntu-latest
        strategy:
            matrix:
                node-version: [18.18.0]
        environment:
            name: github-pages
            url: ${{ steps.deployment.outputs.page_url }}
        steps:
            - name: âš™ï¸ Deploying Pages
              uses: actions/deploy-pages@v4
              
            - run: echo 'âœ… Success deployed!'
            
